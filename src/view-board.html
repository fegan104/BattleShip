<!-- @author Frank Egan -->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="view-tile.html">

<dom-module id="view-board">
  <template>
    <style>
      :host {
        display: block;
        --bs-blue: #1976D2;
      }
      .board {
        width: 45vw;
        background: rgba(176,190,197 ,1);
        float: right;
      }

      .square {
        float:left;
        position: relative;
        width: calc(4.5vw - 4px);
        padding-bottom: calc(4.5vw - 4px); /* = width for a 1:1 aspect ratio */
        margin: 2px;
        background: var(--bs-blue);
      }

    </style>
      <div id="board" class="board"></div>
  </template>

  <script>
    Polymer({
      is: 'view-board',
      properties:{
        height:{
          type: Number,
          value: 10
        },
        width:{
          type: Number,
          readOnly: true,
          value: 10
        },
        cursor:{
          type:Object,
          notify: true,
          value: {x:0, y:0, show: false}
        }
      },
      listeners:{
        'tile-tap': 'tapped'
      },
      ready: function(){
        var board = this.$.board;
        for (var i = 0; i < this.height; i++) {
          for (var j = 0; j < this.width; j++) {
            var tile = document.createElement('view-tile');
            tile.x = j;
            tile.y = i;
            board.appendChild(tile);
          }
        }
      },
      tapped: function(e, d){
        console.log("(" + e.detail.x + ", " + e.detail.y + ")");
        this._updateCursor(e.detail.x, e.detail.y);
      },
      getTile: function(x, y) {
        return this.$.board.childNodes[x + 10*y];
      },
      _updateCursor: function(x, y) {
        //if we click on the cursor remove it
        if (this.cursor.show && this.cursor.x === x && this.cursor.y === y) {
          this.getTile(x, y).showCursor(false);
          this.cursor = {x:x, y:y, show:false};//update value
          return;
        } else if (this.cursor.show) {//if it's currently visible hide it and place somewhere else
          this.getTile(this.cursor.x, this.cursor.y).showCursor(false);
          this.getTile(x, y).showCursor(true);
        } else {
          this.getTile(x, y).showCursor(true);
        }
        this.cursor = {x:x, y:y, show:true};//update value
      }
    });
  </script>
</dom-module>
